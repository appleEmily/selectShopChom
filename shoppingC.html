
<!-- 説明なし / 割引あり -->
<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>通販サイト</title>
    <link rel="stylesheet" href="shoppingStyles.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap" rel="stylesheet">


    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">

    <!-- Swiper JS -->
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>

</head>

<body>
    <!--  トップ画像 -->
    <!-- Swiper container -->
    <div class="swiper-container">
        <!-- Additional required wrapper -->
        <div class="swiper-wrapper">
            <!-- Slides -->
            <div class="swiper-slide"><img src="images/topB.png" alt="Image 1"></div>
            <div class="swiper-slide"><img src="images/topA.png" alt="Image 2"></div>
            <div class="swiper-slide"><img src="images/topC.png" alt="Image 3"></div>
            <div class="swiper-slide"><img src="images/topD.png" alt="Image 4"></div>
            <!-- ... -->
        </div>
        <!-- If we need pagination -->
        <div class="swiper-pagination"></div>
    </div>

    <h2> New Arrivals</h2>
    
    <div class="parent-of-products">
        <div class="products">
            <!-- 一つの商品 -->
            <div class="product">
                <img src="images/product0.png" alt="商品画像1" class="productImg">
                <div class="product-name">商品名1</div>
                <div class="product-price">¥10000</div>
                <button class="add-to-cart-btn">Add to Cart</button>
            </div>
            <div class="product">
                <img src="images/product1.png" alt="商品画像1" class="productImg">
                <img src="images/ecofriendly.png" alt="Mark" class="mark-image"> <!-- eco -->
                <div class="product-name">商品名1</div>
                <div class="product-price">¥10000</div>
                <button class="add-to-cart-btn">Add to Cart</button>
            </div>
            <div class="product">
                <img src="images/product2.png" alt="商品画像1" class="productImg">
                <div class="product-name">商品名1</div>
                <div class="product-price">¥10000</div>
                <button class="add-to-cart-btn">Add to Cart</button>
            </div>
            <div class="product">
                <img src="images/product2.png" alt="商品画像1" class="productImg">
                <div class="product-name">商品名1</div>
                <div class="product-price">¥10000</div>
                <button class="add-to-cart-btn">Add to Cart</button>
            </div>

        </div>
    </div>

</body>

<footer>
    <h2>YOUR CART</h2>
    <div class="carts">
        <div class="cart-items" id="cart-items">
            <!-- ここに選択された商品が追加されます -->
        </div>
        <div class="totalButton">
            <div class="cart-total">
                <h3>合計</h3>
                <span id="yen">¥<span id="total-price">0</span></span>
            </div>
            <button class="finish-shopping">Finish Shopping</button>
        </div>
    </div>

</footer>


<!--　カートに追加java -->
<script>
    // カートに追加された商品を保存する配列
    let cart = [];

    document.addEventListener('DOMContentLoaded', function () {
        let addToCartButtons = document.querySelectorAll('.add-to-cart-btn');

        addToCartButtons.forEach(button => {
            button.addEventListener('click', function () {
                let productDiv = this.parentElement;
                let productName = productDiv.querySelector('.product-name').innerText;
                let productPrice = parseFloat(productDiv.querySelector('.product-price')
                    .innerText.replace('¥', ''));
                let productImage = productDiv.querySelector('img').src;
                //ecoマークがあるかどうか。
                let isEco = productDiv.querySelector('.mark-image') !== null;

                // カートに商品情報を追加
                cart.push({
                    name: productName,
                    price: productPrice,
                    image: productImage,
                    eco: isEco
                });

                // カート表示を更新
                let cartItems = document.getElementById('cart-items');
                let newItem = document.createElement('div');
                newItem.className = "cart-item";
                newItem.innerHTML = `
            <img src="${productImage}" alt="${productName}" class="cart-item-image">
            `;
                cartItems.appendChild(newItem);

                updateTotalPrice(productPrice);
            });
        });
    });
</script>

<script>
    // カート内の合計金額を計算・更新する関数
function updateTotalPrice() {
    let currentTotal = 0;
    let ecoCount = 0;

    for (let item of cart) {
        currentTotal += item.price;
        if (item.eco) ecoCount++;
    }

    // もし「eco」マーク付きの商品が2つ以上なら10%オフ
    let discountApplied = false;
    if (ecoCount >= 2) {
        currentTotal *= 0.9; // 10%オフ
        discountApplied = true;
    }

    document.getElementById('total-price').innerText = Math.floor(currentTotal); // 切り捨てて整数を表示

    // すでに「割引適用済み」が表示されているかどうかをチェック
    let existingNotice = document.querySelector('.cart-total .discount-notice');
    if (discountApplied && !existingNotice) {
        let discountNotice = document.createElement('div');
        discountNotice.className = 'discount-notice';
        discountNotice.innerText = "割引適用済み";
        document.querySelector('.cart-total').appendChild(discountNotice);
    } else if (!discountApplied && existingNotice) {
        existingNotice.remove();
    }
}


</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
        const finishShoppingButton = document.querySelector('.finish-shopping');
        finishShoppingButton.addEventListener('click', sendToSheet);
    });

    function sendToSheet() {
        //ボタンの無効化
        const finishShoppingButton = document.querySelector('.finish-shopping');
    finishShoppingButton.disabled = true;

        var url =
            'https://script.google.com/macros/s/AKfycbw2gN8b1dWFeYyEJeYbZY9MCmyNz8bmnzDt5VjoY-hMGzdWcklN4Iy7HFYVspsU6k81/exec';

        var formData = new FormData(); // フォームデータを作成

        var productsInCart = cart.map(item => item.name);
        formData.append('sheetName', window.location.pathname.split("/").pop().replace(".html", ""));
        formData.append('purchases', productsInCart);
        formData.append('type', 'shopping');

        fetch(url, {
                method: 'POST',
                body: formData, // フォームデータを送信
            })
            .then(response => {
                console.log("Response received:", response);
                return response.text();
            })
            .then(text => {
                console.log("Response body:", text);
                window.location.href = "survey.html";
            })
            .catch(error => {
                console.error("Fetch error:", error);
            });
    }
</script>

<script>
    var swiper = new Swiper('.swiper-container', {
        // 2秒（2000ミリ秒）ごとにスライドを変更
        autoplay: {
            delay: 3000,
        },
        // 他のオプションもこちらに追加できます
        loop: true,
        pagination: {
            el: '.swiper-pagination',
            clickable: true,
        },
        speed: 1000
    });
</script>


</html>